name: basic_statements
categories:
- statements
tests:

- name: basic_load
  categories:
  - load
  tests:
  - script: 'load test'
    result:
      _class: Load
      to_load:
        _class: SpecialReference
        value: ALL
      from_dialect: 'test'
      into:
        _class: Reference
        value: 'test'
  - script: 'load test test2'
    result:
    - _class: Load
      to_load:
        _class: SpecialReference
        value: ALL
      from_dialect: 'test'
      into:
        _class: Reference
        value: 'test'
    - _class: Load
      to_load:
        _class: SpecialReference
        value: ALL
      from_dialect: 'test2'
      into:
        _class: Reference
        value: 'test2'
  - script: 'load test into alias'
    result:
      _class: Load
      to_load:
        _class: SpecialReference
        value: ALL
      from_dialect: 'test'
      into:
        _class: Reference
        value: 'alias'
  - script: 'load test test-two into ~'
    result:
    - _class: Load
      to_load:
        _class: SpecialReference
        value: ALL
      from_dialect: 'test'
      into:
        _class: SpecialReference
        value: ROOT
    - _class: Load
      to_load:
        _class: SpecialReference
        value: ALL
      from_dialect: 'test-two'
      into:
        _class: SpecialReference
        value: ROOT
  - script: 'load * from test'
    result:
      _class: Load
      to_load:
        _class: SpecialReference
        value: ALL
      from_dialect: 'test'
      into:
        _class: SpecialReference
        value: ROOT
  - script: 'load test test2 from dialect-name'
    result:
    - _class: Load
      to_load:
      - 'test'
      - 'test2'
      from_dialect: 'dialect-name'
      into:
        _class: SpecialReference
        value: ROOT
  - script: 'load test from dialect-name into alias'
    result:
      _class: Load
      to_load:
      - 'test'
      from_dialect: 'dialect-name'
      into:
        _class: Reference
        value: 'alias'
  - script: 'load test test_two from dialect-info into ~'
    result:
      _class: Load
      to_load:
      - 'test'
      - 'test_two'
      from_dialect: 'dialect-info'
      into:
        _class: SpecialReference
        value: ROOT

- name: basic_modifier_defs
  categories:
  - modifier_defs
  tests:
  - script: 'name<-|'
    result:
      _class: ModifierDef
      target: name
      parameters: []
      definition: []
  - script: 'name<-1d6'
    result:
      _class: ModifierDef
      target: name
      parameters: []
      definition:
        _class: Dice
        number_of_dice: 1
        sides: 6
  - script: 'name<-[]'
    result:
      _class: ModifierDef
      target: 'name'
      parameters: []
      definition: []
  - script: 'name<-()[]'
    result:
      _class: ModifierDef
      target: 'name'
      parameters: []
      definition: []
  - script: 'name <- () 1'
    result:
      _class: ModifierDef
      target: 'name'
      parameters: []
      definition: 1
  - script: 'name<-(param)[]'
    result:
      _class: ModifierDef
      target: 'name'
      parameters: ['param']
      definition: []
  - script: 'name<-(param1) 1 + 2'
    result:
      _class: ModifierDef
      target: 'name'
      parameters: ['param1']
      definition:
        _class: Math
        left: 1
        op: '+'
        right: 2
  - script: 'name<-(param1) ? + 2'
    result:
      _class: ModifierDef
      target: 'name'
      parameters: ['param1']
      definition:
        _class: Math
        left:
          _class: SpecialReference
          value: SUBJECT
        op: '+'
        right: 2
  - script: 'name<-(param1, param2) param1 + param2'
    result:
      _class: ModifierDef
      target: 'name'
      parameters:
      - 'param1'
      - 'param2'
      definition:
        _class: Math
        left:
          _class: Reference
          value: 'param1'
        op: '+'
        right:
          _class: Reference
          value: 'param2'
  - script: 'name<-(param1, param2) [param1 + param2]'
    result:
      _class: ModifierDef
      target: 'name'
      parameters:
      - 'param1'
      - 'param2'
      definition:
      - _class: Math
        left:
          _class: Reference
          value: 'param1'
        op: '+'
        right:
          _class: Reference
          value: 'param2'
  - script: 'name<-(param1, param2)[ ?{1} = 3 ]'
    result:
      _class: ModifierDef
      target: 'name'
      parameters:
      - 'param1'
      - 'param2'
      definition:
      - _class: Assignment
        target:
          _class: Access
          accessing:
            _class: SpecialReference
            value: SUBJECT
          accessors:
          - _class: Reduce
            value: 1
        value: 3
  - script: 'name<-(param1, param2)[
            param1 + param2
            ?{1} = 3
        ]'
    result:
      _class: ModifierDef
      target: 'name'
      parameters:
      - 'param1'
      - 'param2'
      definition:
      - _class: Math
        left:
          _class: Reference
          value: 'param1'
        op: '+'
        right:
          _class: Reference
          value: 'param2'
      - _class: Assignment
        target:
          _class: Access
          accessing:
            _class: SpecialReference
            value: SUBJECT
          accessors:
          - _class: Reduce
            value: 1
        value: 3

- name: basic_assignment
  categories:
  - assignment
  tests:
  - script: 'name = 1'
    result:
      _class: Assignment
      target: name
      value: 1
  - script: 'name += 1'
    result:
      _class: Assignment
      target: 'name'
      value:
        _class: Math
        left:
          _class: Reference
          value: 'name'
        op: '+'
        right: 1
  - script: 'name -= 1'
    result:
      _class: Assignment
      target: 'name'
      value:
        _class: Math
        left:
          _class: Reference
          value: 'name'
        op: '-'
        right: 1
  - script: 'name /= 1'
    result:
      _class: Assignment
      target: 'name'
      value:
        _class: Math
        left:
          _class: Reference
          value: 'name'
        op: '/'
        right: 1
  - script: 'name //= 1'
    result:
      _class: Assignment
      target: 'name'
      value:
        _class: Math
        left:
          _class: Reference
          value: 'name'
        op: '//'
        right: 1
  - script: 'name %= 1'
    result:
      _class: Assignment
      target: 'name'
      value:
        _class: Math
        left:
          _class: Reference
          value: 'name'
        op: '%'
        right: 1
  - script: 'name &= 1'
    result:
      _class: Assignment
      target: 'name'
      value:
        _class: RollMath
        left:
          _class: Reference
          value: 'name'
        op: '&'
        right: 1
  - script: 'name ^= 1'
    result:
      _class: Assignment
      target: 'name'
      value:
        _class: RollMath
        left:
          _class: Reference
          value: 'name'
        op: '^'
        right: 1
  - script: '?{1} = 3'
    result:
      _class: Assignment
      target:
        _class: Access
        accessing:
          _class: SpecialReference
          value: SUBJECT
        accessors:
        - _class: Reduce
          value: 1
      value: 3
  - script: 'name = 1d6'
    result:
      _class: Assignment
      target: name
      value:
        _class: Dice
        number_of_dice: 1
        sides: 6
  - script: 'name = {2}'
    result:
      _class: Assignment
      target: name
      value:
        _class: Reduce
        value: 2
  - script: 'name = {@}'
    result:
      _class: Assignment
      target: name
      value:
        _class: Enlarge
        size: null
        value: null
  - script: 'name = {1d6@(3d4 + 5)}'
    result:
      _class: Assignment
      target: name
      value:
        _class: Enlarge
        size:
          _class: Dice
          number_of_dice: 1
          sides: 6
        value:
          _class: Math
          left:
            _class: Dice
            number_of_dice: 3
            sides: 4
          op: '+'
          right: 5
  - script: 'name = value'
    result:
      _class: Assignment
      target: name
      value:
        _class: Reference
        value: 'value'
  - script: 'name = {1d6}->top(2)'
    result:
      _class: Assignment
      target: name
      value:
        _class: Modify
        subject:
          _class: Reduce
          value:
            _class: Dice
            number_of_dice: 1
            sides: 6
        modifiers:
        - modifier:
            _class: Reference
            value: 'top'
          args: [2]
          _class: ModifierCall
  - script: 'name = {{(2d4)d6}->top(3)}'
    result:
      _class: Assignment
      target: name
      value:
        _class: Reduce
        value:
          _class: Modify
          subject:
            _class: Reduce
            value:
              _class: Dice
              number_of_dice:
                _class: Dice
                number_of_dice: 2
                sides: 4
              sides: 6
          modifiers:
          - modifier:
              _class: Reference
              value: 'top'
            args: [3]
            _class: ModifierCall
